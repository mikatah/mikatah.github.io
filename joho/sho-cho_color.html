<!doctype html>
<html lang="ja" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Color Contrast Explorer</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      box-sizing: border-box;
    }
  </style>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full m-0 p-0 font-sans bg-gradient-to-br from-indigo-500 to-purple-600">
  <div class="h-full w-full p-6 flex flex-col gap-6 max-w-7xl mx-auto overflow-auto"><!-- Header -->
   <header class="text-center text-white p-4 bg-white bg-opacity-10 rounded-2xl backdrop-blur-md">
    <h1 id="title" class="text-4xl font-bold mb-2">色のコントラスト体験ツール</h1>
    <p id="subtitle" class="text-base opacity-90">色で表す、日本の省庁</p>
   </header><!-- Main Content -->
   <main class="grid grid-cols-1 lg:grid-cols-3 gap-6 flex-1"><!-- Background Color Control -->
    <section class="bg-white rounded-2xl p-6 shadow-xl flex flex-col gap-5">
     <h2 class="text-xl font-semibold text-center pb-3 border-b-2 border-gray-100">背景色</h2>
     <div class="flex flex-col gap-2">
      <div class="flex justify-between items-center text-sm font-medium text-gray-700"><span>色相 (Hue)</span> <span id="bg-hue-value" class="font-semibold text-indigo-600">180°</span>
      </div>
      <div class="h-40 flex justify-center items-center my-4">
       <div id="bg-hue-slider" class="relative w-40 h-40">
        <canvas id="bg-hue-canvas" width="160" height="160" class="rounded-full"></canvas>
        <div id="bg-hue-thumb" class="absolute w-6 h-6 bg-white border-3 border-gray-800 rounded-full cursor-grab active:cursor-grabbing shadow-lg"></div>
       </div>
      </div>
     </div>
     <div class="flex flex-col gap-2">
      <div class="flex justify-between items-center text-sm font-medium text-gray-700"><span>彩度 (Saturation)</span> <span id="bg-sat-value" class="font-semibold text-indigo-600">50%</span>
      </div>
      <div id="bg-sat-slider" class="relative h-8 rounded-full cursor-pointer shadow-inner">
       <div id="bg-sat-thumb" class="absolute top-1/2 w-5 h-5 bg-white border-3 border-gray-800 rounded-full -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-lg"></div>
      </div>
     </div>
     <div class="flex flex-col gap-2">
      <div class="flex justify-between items-center text-sm font-medium text-gray-700"><span>明度 (Brightness)</span> <span id="bg-bright-value" class="font-semibold text-indigo-600">90%</span>
      </div>
      <div id="bg-bright-slider" class="relative h-8 rounded-full cursor-pointer shadow-inner">
       <div id="bg-bright-thumb" class="absolute top-1/2 w-5 h-5 bg-white border-3 border-gray-800 rounded-full -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-lg"></div>
      </div>
     </div>
    </section><!-- Preview Panel -->
    <section class="bg-white rounded-2xl p-6 shadow-xl flex flex-col gap-4">
     <div class="flex items-center justify-center gap-4 pb-3 border-b-2 border-gray-100">
      <h2 class="text-xl font-semibold">プレビュー</h2><button id="fullscreen-btn" class="px-4 py-2 bg-indigo-600 text-white font-semibold text-sm rounded-lg hover:bg-indigo-700 transition-all shadow-md hover:shadow-lg hover:-translate-y-0.5 whitespace-nowrap"> フルスクリーン表示 </button>
     </div>
     <div class="flex flex-col gap-3">
      <div class="text-sm font-semibold text-gray-700 text-center">
       省庁を選ぶ
      </div>
      <div class="grid grid-cols-3 gap-2"><button class="ministry-btn px-3 py-2.5 border-2 border-gray-300 bg-white rounded-lg font-semibold text-xs text-center hover:border-indigo-600 hover:bg-indigo-50 transition-all hover:-translate-y-0.5" data-ministry="内閣府">内閣府</button> <button class="ministry-btn px-3 py-2.5 border-2 border-gray-300 bg-white rounded-lg font-semibold text-xs text-center hover:border-indigo-600 hover:bg-indigo-50 transition-all hover:-translate-y-0.5" data-ministry="総務省">総務省</button> <button class="ministry-btn px-3 py-2.5 border-2 border-gray-300 bg-white rounded-lg font-semibold text-xs text-center hover:border-indigo-600 hover:bg-indigo-50 transition-all hover:-translate-y-0.5" data-ministry="法務省">法務省</button> <button class="ministry-btn px-3 py-2.5 border-2 border-gray-300 bg-white rounded-lg font-semibold text-xs text-center hover:border-indigo-600 hover:bg-indigo-50 transition-all hover:-translate-y-0.5" data-ministry="外務省">外務省</button> <button class="ministry-btn px-3 py-2.5 border-2 border-gray-300 bg-white rounded-lg font-semibold text-xs text-center hover:border-indigo-600 hover:bg-indigo-50 transition-all hover:-translate-y-0.5" data-ministry="財務省">財務省</button> <button class="ministry-btn px-3 py-2.5 border-2 border-gray-300 bg-white rounded-lg font-semibold text-xs text-center hover:border-indigo-600 hover:bg-indigo-50 transition-all hover:-translate-y-0.5" data-ministry="文部科学省">文部科学省</button>
      </div>
     </div>
     <div id="color-preview" class="flex-1 rounded-xl flex items-center justify-center p-8 shadow-inner min-h-[180px]">
      <div id="preview-text" class="text-5xl font-bold text-center leading-snug break-words">
       総務省
      </div>
     </div>
     <div class="grid grid-cols-3 gap-2"><button class="ministry-btn px-3 py-2.5 border-2 border-gray-300 bg-white rounded-lg font-semibold text-xs text-center hover:border-indigo-600 hover:bg-indigo-50 transition-all hover:-translate-y-0.5" data-ministry="厚生労働省">厚生労働省</button> <button class="ministry-btn px-3 py-2.5 border-2 border-gray-300 bg-white rounded-lg font-semibold text-xs text-center hover:border-indigo-600 hover:bg-indigo-50 transition-all hover:-translate-y-0.5" data-ministry="農林水産省">農林水産省</button> <button class="ministry-btn px-3 py-2.5 border-2 border-gray-300 bg-white rounded-lg font-semibold text-xs text-center hover:border-indigo-600 hover:bg-indigo-50 transition-all hover:-translate-y-0.5" data-ministry="経済産業省">経済産業省</button> <button class="ministry-btn px-3 py-2.5 border-2 border-gray-300 bg-white rounded-lg font-semibold text-xs text-center hover:border-indigo-600 hover:bg-indigo-50 transition-all hover:-translate-y-0.5" data-ministry="国土交通省">国土交通省</button> <button class="ministry-btn px-3 py-2.5 border-2 border-gray-300 bg-white rounded-lg font-semibold text-xs text-center hover:border-indigo-600 hover:bg-indigo-50 transition-all hover:-translate-y-0.5" data-ministry="環境省">環境省</button> <button class="ministry-btn px-3 py-2.5 border-2 border-gray-300 bg-white rounded-lg font-semibold text-xs text-center hover:border-indigo-600 hover:bg-indigo-50 transition-all hover:-translate-y-0.5" data-ministry="防衛省">防衛省</button>
     </div>
    </section><!-- Text Color Control -->
    <section class="bg-white rounded-2xl p-6 shadow-xl flex flex-col gap-5">
     <h2 class="text-xl font-semibold text-center pb-3 border-b-2 border-gray-100">文字色</h2>
     <div class="flex flex-col gap-2">
      <div class="flex justify-between items-center text-sm font-medium text-gray-700"><span>色相 (Hue)</span> <span id="text-hue-value" class="font-semibold text-indigo-600">0°</span>
      </div>
      <div class="h-40 flex justify-center items-center my-4">
       <div id="text-hue-slider" class="relative w-40 h-40">
        <canvas id="text-hue-canvas" width="160" height="160" class="rounded-full"></canvas>
        <div id="text-hue-thumb" class="absolute w-6 h-6 bg-white border-3 border-gray-800 rounded-full cursor-grab active:cursor-grabbing shadow-lg"></div>
       </div>
      </div>
     </div>
     <div class="flex flex-col gap-2">
      <div class="flex justify-between items-center text-sm font-medium text-gray-700"><span>彩度 (Saturation)</span> <span id="text-sat-value" class="font-semibold text-indigo-600">0%</span>
      </div>
      <div id="text-sat-slider" class="relative h-8 rounded-full cursor-pointer shadow-inner">
       <div id="text-sat-thumb" class="absolute top-1/2 w-5 h-5 bg-white border-3 border-gray-800 rounded-full -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-lg"></div>
      </div>
     </div>
     <div class="flex flex-col gap-2">
      <div class="flex justify-between items-center text-sm font-medium text-gray-700"><span>明度 (Brightness)</span> <span id="text-bright-value" class="font-semibold text-indigo-600">10%</span>
      </div>
      <div id="text-bright-slider" class="relative h-8 rounded-full cursor-pointer shadow-inner">
       <div id="text-bright-thumb" class="absolute top-1/2 w-5 h-5 bg-white border-3 border-gray-800 rounded-full -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-lg"></div>
      </div>
     </div>
    </section>
   </main>
  </div><!-- Fullscreen Overlay -->
  <div id="fullscreen-overlay" class="fixed inset-0 z-[9999] hidden items-center justify-center">
   <div id="fullscreen-content" class="w-full h-full flex items-center justify-center relative">
    <div id="fullscreen-text" class="text-[120px] font-bold text-center leading-snug break-words px-8">
     総務省
    </div><button id="close-fullscreen-btn" class="absolute top-6 right-6 w-12 h-12 bg-white bg-opacity-90 rounded-full flex items-center justify-center text-2xl text-gray-800 hover:bg-white hover:scale-110 transition-all shadow-lg">✕</button>
   </div>
  </div>
  <script>
    const defaultConfig = {
      title_text: "色のコントラスト体験ツール",
      subtitle_text: "色で表す、日本の省庁",
      preview_text: "総務省",
      background_color: "#667eea",
      text_color: "#333333",
      font_family: "Hiragino Sans",
      font_size: 16
    };

    let config = { ...defaultConfig };

    const bgColor = { h: 180, s: 50, b: 90 };
    const textColor = { h: 0, s: 0, b: 10 };

    function drawHueWheel(canvasId) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext('2d');
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const outerRadius = 70;
      const innerRadius = 52;

      for (let angle = 0; angle < 360; angle += 0.5) {
        const startAngle = (angle - 90) * Math.PI / 180;
        const endAngle = (angle + 0.5 - 90) * Math.PI / 180;

        ctx.beginPath();
        ctx.arc(centerX, centerY, outerRadius, startAngle, endAngle);
        ctx.arc(centerX, centerY, innerRadius, endAngle, startAngle, true);
        ctx.closePath();

        ctx.fillStyle = `hsl(${angle}, 100%, 50%)`;
        ctx.fill();
      }
    }

    function hsbToRgb(h, s, b) {
      s = s / 100;
      b = b / 100;
      const c = b * s;
      const x = c * (1 - Math.abs(((h / 60) % 2) - 1));
      const m = b - c;
      let r, g, bl;

      if (h < 60) { r = c; g = x; bl = 0; }
      else if (h < 120) { r = x; g = c; bl = 0; }
      else if (h < 180) { r = 0; g = c; bl = x; }
      else if (h < 240) { r = 0; g = x; bl = c; }
      else if (h < 300) { r = x; g = 0; bl = c; }
      else { r = c; g = 0; bl = x; }

      return {
        r: Math.round((r + m) * 255),
        g: Math.round((g + m) * 255),
        b: Math.round((bl + m) * 255)
      };
    }

    function rgbToHex(r, g, b) {
      return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('').toUpperCase();
    }

    function updatePreview() {
      const bgRgb = hsbToRgb(bgColor.h, bgColor.s, bgColor.b);
      const textRgb = hsbToRgb(textColor.h, textColor.s, textColor.b);
      
      const bgHex = rgbToHex(bgRgb.r, bgRgb.g, bgRgb.b);
      const textHex = rgbToHex(textRgb.r, textRgb.g, textRgb.b);

      const preview = document.getElementById('color-preview');
      const previewText = document.getElementById('preview-text');
      
      preview.style.backgroundColor = bgHex;
      previewText.style.color = textHex;

      // Update slider gradients
      const bgSatColor = hsbToRgb(bgColor.h, 100, bgColor.b);
      const bgBrightColor = hsbToRgb(bgColor.h, bgColor.s, 100);
      document.getElementById('bg-sat-slider').style.background = `linear-gradient(to right, #808080, ${rgbToHex(bgSatColor.r, bgSatColor.g, bgSatColor.b)})`;
      document.getElementById('bg-bright-slider').style.background = `linear-gradient(to right, #000000, ${rgbToHex(bgBrightColor.r, bgBrightColor.g, bgBrightColor.b)})`;

      const textSatColor = hsbToRgb(textColor.h, 100, textColor.b);
      const textBrightColor = hsbToRgb(textColor.h, textColor.s, 100);
      document.getElementById('text-sat-slider').style.background = `linear-gradient(to right, #808080, ${rgbToHex(textSatColor.r, textSatColor.g, textSatColor.b)})`;
      document.getElementById('text-bright-slider').style.background = `linear-gradient(to right, #000000, ${rgbToHex(textBrightColor.r, textBrightColor.g, textBrightColor.b)})`;
    }

    function setupHueSlider(sliderId, thumbId, valueId, colorObj) {
      const slider = document.getElementById(sliderId);
      const thumb = document.getElementById(thumbId);
      const valueDisplay = document.getElementById(valueId);
      const track = slider.querySelector('canvas');
      
      let isDragging = false;

      function updateThumbPosition() {
        const angleRad = (colorObj.h * Math.PI) / 180;
        const radius = 60;
        const centerX = 80;
        const centerY = 80;
        
        const x = centerX + radius * Math.cos(angleRad - Math.PI / 2);
        const y = centerY + radius * Math.sin(angleRad - Math.PI / 2);
        
        thumb.style.left = x + 'px';
        thumb.style.top = y + 'px';
        thumb.style.transform = 'translate(-50%, -50%)';
        valueDisplay.textContent = Math.round(colorObj.h) + '°';
      }

      function handleMove(clientX, clientY) {
        const rect = track.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        
        const dx = clientX - centerX;
        const dy = clientY - centerY;
        
        let angleRad = Math.atan2(dy, dx);
        let angleDeg = (angleRad * 180) / Math.PI + 90;
        
        if (angleDeg < 0) angleDeg += 360;
        if (angleDeg >= 360) angleDeg -= 360;
        
        colorObj.h = angleDeg;
        updateThumbPosition();
        updatePreview();
      }

      track.addEventListener('mousedown', (e) => {
        isDragging = true;
        handleMove(e.clientX, e.clientY);
      });

      thumb.addEventListener('mousedown', (e) => {
        isDragging = true;
        e.stopPropagation();
      });

      document.addEventListener('mousemove', (e) => {
        if (isDragging) {
          handleMove(e.clientX, e.clientY);
        }
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
      });

      track.addEventListener('touchstart', (e) => {
        isDragging = true;
        const touch = e.touches[0];
        handleMove(touch.clientX, touch.clientY);
        e.preventDefault();
      });

      document.addEventListener('touchmove', (e) => {
        if (isDragging) {
          const touch = e.touches[0];
          handleMove(touch.clientX, touch.clientY);
          e.preventDefault();
        }
      }, { passive: false });

      document.addEventListener('touchend', () => {
        isDragging = false;
      });

      updateThumbPosition();
    }

    function setupLinearSlider(sliderId, thumbId, valueId, colorObj, property) {
      const slider = document.getElementById(sliderId);
      const thumb = document.getElementById(thumbId);
      const valueDisplay = document.getElementById(valueId);
      
      let isDragging = false;

      function updateThumbPosition() {
        const percentage = colorObj[property];
        thumb.style.left = percentage + '%';
        valueDisplay.textContent = Math.round(percentage) + '%';
      }

      function handleMove(clientX) {
        const rect = slider.getBoundingClientRect();
        let percentage = ((clientX - rect.left) / rect.width) * 100;
        percentage = Math.max(0, Math.min(100, percentage));
        
        colorObj[property] = percentage;
        updateThumbPosition();
        updatePreview();
      }

      slider.addEventListener('mousedown', (e) => {
        isDragging = true;
        handleMove(e.clientX);
      });

      thumb.addEventListener('mousedown', (e) => {
        isDragging = true;
        e.stopPropagation();
      });

      document.addEventListener('mousemove', (e) => {
        if (isDragging) {
          handleMove(e.clientX);
        }
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
      });

      slider.addEventListener('touchstart', (e) => {
        isDragging = true;
        const touch = e.touches[0];
        handleMove(touch.clientX);
        e.preventDefault();
      });

      document.addEventListener('touchmove', (e) => {
        if (isDragging) {
          const touch = e.touches[0];
          handleMove(touch.clientX);
          e.preventDefault();
        }
      }, { passive: false });

      document.addEventListener('touchend', () => {
        isDragging = false;
      });

      updateThumbPosition();
    }

    // Ministry button handlers
    document.querySelectorAll('.ministry-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const ministry = btn.getAttribute('data-ministry');
        document.getElementById('preview-text').textContent = ministry;
        document.getElementById('fullscreen-text').textContent = ministry;
      });
    });

    // Fullscreen functionality
    const fullscreenBtn = document.getElementById('fullscreen-btn');
    const fullscreenOverlay = document.getElementById('fullscreen-overlay');
    const fullscreenContent = document.getElementById('fullscreen-content');
    const fullscreenText = document.getElementById('fullscreen-text');
    const closeFullscreenBtn = document.getElementById('close-fullscreen-btn');

    function openFullscreen() {
      const bgRgb = hsbToRgb(bgColor.h, bgColor.s, bgColor.b);
      const textRgb = hsbToRgb(textColor.h, textColor.s, textColor.b);
      const bgHex = rgbToHex(bgRgb.r, bgRgb.g, bgRgb.b);
      const textHex = rgbToHex(textRgb.r, textRgb.g, textRgb.b);

      fullscreenContent.style.backgroundColor = bgHex;
      fullscreenText.style.color = textHex;
      fullscreenText.textContent = document.getElementById('preview-text').textContent;
      fullscreenOverlay.classList.remove('hidden');
      fullscreenOverlay.classList.add('flex');
    }

    function closeFullscreen() {
      fullscreenOverlay.classList.add('hidden');
      fullscreenOverlay.classList.remove('flex');
    }

    fullscreenBtn.addEventListener('click', openFullscreen);
    closeFullscreenBtn.addEventListener('click', closeFullscreen);
    
    fullscreenContent.addEventListener('click', (e) => {
      if (e.target === fullscreenContent) {
        closeFullscreen();
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !fullscreenOverlay.classList.contains('hidden')) {
        closeFullscreen();
      }
    });

    async function onConfigChange(newConfig) {
      const customFont = newConfig.font_family || defaultConfig.font_family;
      const baseFontStack = 'Hiragino Sans, Hiragino Kaku Gothic ProN, Noto Sans JP, sans-serif';
      const baseSize = newConfig.font_size || defaultConfig.font_size;

      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
      
      document.getElementById('title').textContent = newConfig.title_text || defaultConfig.title_text;
      document.getElementById('title').style.fontSize = `${baseSize * 2}px`;
      
      document.getElementById('subtitle').textContent = newConfig.subtitle_text || defaultConfig.subtitle_text;
      document.getElementById('subtitle').style.fontSize = `${baseSize}px`;
      
      const previewTextElement = document.getElementById('preview-text');
      if (previewTextElement.textContent === config.preview_text || previewTextElement.textContent === defaultConfig.preview_text) {
        previewTextElement.textContent = newConfig.preview_text || defaultConfig.preview_text;
        document.getElementById('fullscreen-text').textContent = newConfig.preview_text || defaultConfig.preview_text;
      }

      document.querySelectorAll('section h2').forEach(el => {
        el.style.fontSize = `${baseSize * 1.25}px`;
      });

      document.querySelectorAll('.ministry-btn').forEach(el => {
        el.style.fontSize = `${baseSize * 0.75}px`;
      });

      document.getElementById('fullscreen-btn').style.fontSize = `${baseSize * 0.875}px`;
      document.getElementById('fullscreen-text').style.fontSize = `${baseSize * 7.5}px`;

      config = { ...newConfig };
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["title_text", config.title_text || defaultConfig.title_text],
          ["subtitle_text", config.subtitle_text || defaultConfig.subtitle_text],
          ["preview_text", config.preview_text || defaultConfig.preview_text]
        ])
      });
    }

    drawHueWheel('bg-hue-canvas');
    drawHueWheel('text-hue-canvas');

    setupHueSlider('bg-hue-slider', 'bg-hue-thumb', 'bg-hue-value', bgColor);
    setupLinearSlider('bg-sat-slider', 'bg-sat-thumb', 'bg-sat-value', bgColor, 's');
    setupLinearSlider('bg-bright-slider', 'bg-bright-thumb', 'bg-bright-value', bgColor, 'b');

    setupHueSlider('text-hue-slider', 'text-hue-thumb', 'text-hue-value', textColor);
    setupLinearSlider('text-sat-slider', 'text-sat-thumb', 'text-sat-value', textColor, 's');
    setupLinearSlider('text-bright-slider', 'text-bright-thumb', 'text-bright-value', textColor, 'b');

    updatePreview();

    onConfigChange(config);
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ad39752c33bdd96',t:'MTc2NTYwOTI5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
  </html>
